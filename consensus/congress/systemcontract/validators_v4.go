package systemcontract

import (
	"math/big"

	"github.com/ethereum/go-ethereum/common"
	"github.com/ethereum/go-ethereum/core"
	"github.com/ethereum/go-ethereum/core/state"
	"github.com/ethereum/go-ethereum/core/types"
	"github.com/ethereum/go-ethereum/log"
	"github.com/ethereum/go-ethereum/params"
)

const (
	validatorV4Code = "0x6080604052600436106200022e5760003560e01c80638a11d7c9116200012f578063be64569211620000ad578063c4e2f07a1162000078578063c4e2f07a14620006fa578063c967f90f146200071f578063d6eb3de1146200074a578063e7c9d4b51462000762578063e8363f6c146200078757600080fd5b8063be6456921462000685578063c1d7dd7814620006a5578063c253c38414620006bd578063c2a672e014620006d557600080fd5b80639de7025811620000fa5780639de7025814620005b3578063a097724214620005cb578063a224cee71462000601578063a22b0f6e1462000626578063bbe4f6db146200064b57600080fd5b80638a11d7c9146200050b5780638b0e9f3f146200054257806393a5b1b6146200055a57806398e3b626146200058e57600080fd5b806340550a1c11620001bd57806363fc5e71116200018857806363fc5e7114620004065780636969a25c14620004405780637ad229da14620004655780637f4f95fa14620004ab57806380d2dde114620004e657600080fd5b806340550a1c146200037f57806340a141ff14620003a457806348cd4cb114620003c95780634b3d500b14620003e157600080fd5b806330fcb67c11620001fe57806330fcb67c14620002d15780633438174914620002ea57806338b67b8b14620003335780633a061bd3146200036757600080fd5b8062362a771462000233578063158ef93e146200026d5780631b5e358c14620002895780632647620414620002ba575b600080fd5b3480156200024057600080fd5b50620002586200025236600462003b12565b620007b8565b60405190151581526020015b60405180910390f35b3480156200027a57600080fd5b50600054620002589060ff1681565b3480156200029657600080fd5b50620002a161f20081565b6040516001600160a01b03909116815260200162000264565b62000258620002cb36600462003b12565b620008e3565b620002e8620002e236600462003b12565b62000df8565b005b348015620002f757600080fd5b50620003246200030936600462003b12565b6001600160a01b031660009081526013602052604090205490565b60405190815260200162000264565b3480156200034057600080fd5b50620003586200035236600462003b78565b62001066565b60405162000264919062003bfb565b3480156200037457600080fd5b50620002a161f10081565b3480156200038c57600080fd5b50620002586200039e36600462003b12565b620011f8565b348015620003b157600080fd5b50620002e8620003c336600462003b12565b6200126a565b348015620003d657600080fd5b506200032460015481565b348015620003ee57600080fd5b50620002a16200040036600462003c10565b620012cb565b3480156200041357600080fd5b50620003246200042536600462003b12565b6001600160a01b03166000908152600f602052604090205490565b3480156200044d57600080fd5b50620002a16200045f36600462003c10565b620012f6565b3480156200047257600080fd5b50620003246200048436600462003c2a565b6001600160a01b039091166000908152601060209081526040808320938352929052205490565b348015620004b857600080fd5b50620004d0620004ca36600462003c57565b62001307565b6040805192835260208301919091520162000264565b348015620004f357600080fd5b50620002e86200050536600462003c2a565b6200133c565b3480156200051857600080fd5b50620005306200052a36600462003b12565b620016d8565b60405162000264949392919062003ce0565b3480156200054f57600080fd5b506200032460085481565b3480156200056757600080fd5b506200057f6200057936600462003c10565b620017d4565b60405162000264919062003d24565b3480156200059b57600080fd5b5062000258620005ad36600462003b12565b62001938565b348015620005c057600080fd5b506200057f620019a1565b348015620005d857600080fd5b50620005f0620005ea36600462003d39565b62001a05565b604051620002649392919062003d89565b3480156200060e57600080fd5b50620002e86200062036600462003b78565b62001c16565b3480156200063357600080fd5b50620002a16200064536600462003c10565b620021e5565b3480156200065857600080fd5b50620002a16200066a36600462003b12565b600c602052600090815260409020546001600160a01b031681565b3480156200069257600080fd5b506200032469021e19e0c9bab240000081565b348015620006b257600080fd5b506200032460095481565b348015620006ca57600080fd5b50620004d0620021f6565b348015620006e257600080fd5b5062000258620006f436600462003c2a565b6200220d565b3480156200070757600080fd5b50620003246200071936600462003c57565b6200262e565b3480156200072c57600080fd5b5062000736601581565b60405161ffff909116815260200162000264565b3480156200075757600080fd5b50620002a161f30081565b3480156200076f57600080fd5b50620002e86200078136600462003dde565b620026f1565b3480156200079457600080fd5b5062000324620007a636600462003b12565b60046020526000908152604090205481565b336000818152600460205260408120805490829055909190801562000858576040516001600160a01b0383169082156108fc029083906000818181858888f193505050501580156200080e573d6000803e3d6000fd5b50604080518281524260208201526001600160a01b0380871692908516917f51a69b4502f660774c9339825c7b5adbf0b8622289134647e29728ec5d9b3bb9910160405180910390a35b6001600160a01b038085166000908152600c6020526040902054168015620008d857604051630c00007b60e41b81526001600160a01b03848116600483015282169063c00007b090602401600060405180830381600087803b158015620008be57600080fd5b505af1158015620008d3573d6000803e3d6000fd5b505050505b506001949350505050565b6000805460ff16620009125760405162461bcd60e51b8152600401620009099062003ec1565b60405180910390fd5b336000818152600d602052604090205434906200093090826200297f565b6001600160a01b038084166000908152600d6020908152604080832094909455918716815260029091522060018101541580156200099e575060016001600160a01b03861660009081526002602052604090205460ff1660038111156200099b576200099b62003c8f565b14155b1562000afd57846001600160a01b0316836001600160a01b031614620009f95760405162461bcd60e51b815260206004820152600f60248201526e32b93937b9103b30b634b230ba37b960891b604482015260640162000909565b600b54604080516325dff9d160e01b8152815160009384936001600160a01b03909116926325dff9d19260048083019392829003018186803b15801562000a3f57600080fd5b505afa15801562000a54573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019062000a7a919062003ee7565b915091508143101562000abd5760405162461bcd60e51b815260206004820152600a6024820152697374617274426c6f636b60b01b604482015260640162000909565b8043111562000afa5760405162461bcd60e51b8152602060048201526008602482015267656e64426c6f636b60c01b604482015260640162000909565b50505b60016001600160a01b03861660009081526002602052604090205460ff16600381111562000b2f5762000b2f62003c8f565b1462000ba257600181015469021e19e0c9bab24000009062000b5290846200297f565b101562000ba25760405162461bcd60e51b815260206004820152601860248201527f5374616b696e6720636f696e73206e6f7420656e6f7567680000000000000000604482015260640162000909565b6001600160a01b0380841660009081526003602090815260408083209389168352929052205462000c2157600380820180546001600160a01b03808716600081815260209586526040808220938c1682529286529182206001908101849055830184559281529290922090910180546001600160a01b03191690911790555b600181015462000c7057846001600160a01b03167fbc822c457926e0706c445f2b613394c8a2bf34b3b4335915e3865b90829ce38b600160405162000c67919062003f0c565b60405180910390a25b600181015462000c8190836200297f565b600180830191909155815460ff16600381111562000ca35762000ca362003c8f565b1462000cb557805460ff191660011781555b62000cc5858260010154620029e9565b6001600160a01b0380841660009081526003602090815260408083209389168352929052205462000cf790836200297f565b6001600160a01b038085166000908152600360209081526040808320938a168352929052205560085462000d2c90836200297f565b6008556001600160a01b038581166000908152600c602052604090819020549051630991d88160e21b81528583166004820152911690819063264762049085906024016000604051808303818588803b15801562000d8957600080fd5b505af115801562000d9e573d6000803e3d6000fd5b5050604080518781524260208201526001600160a01b03808c169550891693507fb9ba725934532316cffe10975da6eb25ad49c2d1c294d982c46c9f8d684ee07592500160405180910390a360019450505050505b919050565b33411462000e365760405162461bcd60e51b815260206004820152600a6024820152694d696e6572206f6e6c7960b01b604482015260640162000909565b436000908152600e6020908152604080832083805290915290205460ff161562000ea35760405162461bcd60e51b815260206004820152601960248201527f426c6f636b20697320616c726561647920726577617264656400000000000000604482015260640162000909565b60005460ff1662000ec85760405162461bcd60e51b8152600401620009099062003ec1565b436000818152600e602090815260408083208380529091529020805460ff191660019081179091555433913491101562000f89576001600160a01b0382166000908152600f6020526040812080549162000f228362003f3f565b9091555050600a54604051631e88772760e01b81526001600160a01b03848116600483015290911690631e88772790602401600060405180830381600087803b15801562000f6f57600080fd5b505af115801562000f84573d6000803e3d6000fd5b505050505b6000811162000f9757505050565b6001600160a01b03821660009081526002602052604081205460ff16600381111562000fc75762000fc762003c8f565b141562000fd357505050565b6001600160a01b03821660009081526013602052604090205462000ff890826200297f565b6001600160a01b0383166000908152601360205260409020556200101d818462002dfe565b604080518281524260208201526001600160a01b038416917f7dc4e5df59513708dca355b8706273a5df7b810a4cec8019f2a4b9bb166a1a04910160405180910390a250505b50565b6060818067ffffffffffffffff81111562001085576200108562003dc8565b604051908082528060200260200182016040528015620010af578160200160208202803683370190505b50915060005b81811015620011f0576000858583818110620010d557620010d562003f5d565b9050602002016020810190620010ec919062003b12565b6001600160a01b038082166000908152600c6020526040812054929350911690811562001191576040516246613160e11b81526001600160a01b038481166004830152831690628cc2629060240160206040518083038186803b1580156200115357600080fd5b505afa15801562001168573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906200118e919062003f73565b90505b6001600160a01b038316600090815260046020526040902054620011b6908262003f8d565b868581518110620011cb57620011cb62003f5d565b6020026020010181815250505050508080620011e79062003f3f565b915050620010b5565b505092915050565b6000805b6005548110156200126157826001600160a01b03166005828154811062001227576200122762003f5d565b6000918252602090912001546001600160a01b031614156200124c5750600192915050565b80620012588162003f3f565b915050620011fc565b50600092915050565b3361f20014620012b45760405162461bcd60e51b815260206004820152601460248201527350756e69736820636f6e7472616374206f6e6c7960601b604482015260640162000909565b600654600110156200106357620010638162003608565b60068181548110620012dc57600080fd5b6000918252602090912001546001600160a01b0316905081565b60058181548110620012dc57600080fd5b6001600160a01b03828116600090815260036020908152604080832093851683529290522080546001909101545b9250929050565b3361f20014620013865760405162461bcd60e51b815260206004820152601460248201527350756e69736820636f6e7472616374206f6e6c7960601b604482015260640162000909565b8160006001600160a01b03841660009081526002602052604090205460ff166003811115620013b957620013b962003c8f565b1415620013ff5760405162461bcd60e51b815260206004820152601360248201527215985b1a59185d1bdc881b9bdd08195e1a5cdd606a1b604482015260640162000909565b6001600160a01b038082166000908152600360209081526040808320938716835292815282822060029091529190208154808511156200143d578094505b846200144b57505050505050565b84811415620015a0576003820154620014679060019062003fa8565b8360010154146200155f57600382018054620014869060019062003fa8565b8154811062001499576200149962003f5d565b9060005260206000200160009054906101000a90046001600160a01b031682600301846001015481548110620014d357620014d362003f5d565b9060005260206000200160006101000a8154816001600160a01b0302191690836001600160a01b031602179055508260010154600360008460030186600101548154811062001526576200152662003f5d565b60009182526020808320909101546001600160a01b0390811684528382019490945260409283018220938b168252929092529020600101555b8160030180548062001575576200157562003fc2565b600082815260208120820160001990810180546001600160a01b031916905590910190915560018401555b8254620015ae90866200364d565b83556001820154620015c190866200364d565b6001830155600854620015d590866200364d565b6008556001600160a01b0384166000908152600d6020526040902054620015fd90866200364d565b6001600160a01b038581166000818152600d60209081526040808320959095558a84168252600c905283902054925163f3fef3a360e01b8152600481019190915260248101889052911690819063f3fef3a390604401600060405180830381600087803b1580156200166e57600080fd5b505af115801562001683573d6000803e3d6000fd5b5050604080518981524260208201526001600160a01b03808c169450891692507f449002ae18e748d69a55f38514400d64f966492e593e32d6e9b8b24db98a0bc1910160405180910390a350505050505b5050565b6001600160a01b03811660009081526002602052604080822081516080810190925280548392839260609284929190829060ff16600381111562001720576200172062003c8f565b600381111562001734576200173462003c8f565b8152602001600182015481526020016002820154815260200160038201805480602002602001604051908101604052809291908181526020018280548015620017a757602002820191906000526020600020905b81546001600160a01b0316815260019091019060200180831162001788575b505050919092525050815160208301516040840151606090940151919a9099509297509550909350505050565b600b54604080516325dff9d160e01b815281516060936000936001600160a01b03909116926325dff9d19260048083019392829003018186803b1580156200181b57600080fd5b505afa15801562001830573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019062001856919062003ee7565b9150506000811180156200186a5750808310155b15620018d5576006805480602002602001604051908101604052809291908181526020018280548015620018c857602002820191906000526020600020905b81546001600160a01b03168152600190910190602001808311620018a9575b5050505050915050919050565b6007805480602002602001604051908101604052809291908181526020018280548015620018c8576020028201919060005260206000209081546001600160a01b03168152600190910190602001808311620018a9575050505050915050919050565b6000805b6006548110156200126157826001600160a01b03166006828154811062001967576200196762003f5d565b6000918252602090912001546001600160a01b031614156200198c5750600192915050565b80620019988162003f3f565b9150506200193c565b60606005805480602002602001604051908101604052809291908181526020018280548015620019fb57602002820191906000526020600020905b81546001600160a01b03168152600190910190602001808311620019dc575b5050505050905090565b60608080848067ffffffffffffffff81111562001a265762001a2662003dc8565b60405190808252806020026020018201604052801562001a50578160200160208202803683370190505b5093508067ffffffffffffffff81111562001a6f5762001a6f62003dc8565b60405190808252806020026020018201604052801562001a99578160200160208202803683370190505b5092508067ffffffffffffffff81111562001ab85762001ab862003dc8565b60405190808252806020026020018201604052801562001ae2578160200160208202803683370190505b50915060005b8181101562001c0b57600088888381811062001b085762001b0862003f5d565b905060200201602081019062001b1f919062003b12565b6001600160a01b03811660009081526010602090815260408083208b845290915290205487519192509087908490811062001b5e5762001b5e62003f5d565b6020908102919091018101919091526001600160a01b03821660009081526011825260408082208a83529092522054855186908490811062001ba45762001ba462003f5d565b6020908102919091018101919091526001600160a01b03821660009081526012825260408082208a83529092522054845185908490811062001bea5762001bea62003f5d565b6020908102919091010152508062001c028162003f3f565b91505062001ae8565b505093509350939050565b60005460ff161562001c615760405162461bcd60e51b8152602060048201526013602482015272105b1c9958591e481a5b9a5d1a585b1a5e9959606a1b604482015260640162000909565b600a80546001600160a01b031990811661f20017909155600b805490911661f30017905560005b818110156200219957600083838381811062001ca85762001ca862003f5d565b905060200201602081019062001cbf919062003b12565b6001600160a01b0316141562001d185760405162461bcd60e51b815260206004820152601960248201527f496e76616c69642076616c696461746f72206164647265737300000000000000604482015260640162000909565b62001d4883838381811062001d315762001d3162003f5d565b90506020020160208101906200039e919062003b12565b62001dae57600583838381811062001d645762001d6462003f5d565b905060200201602081019062001d7b919062003b12565b81546001810183556000928352602090922090910180546001600160a01b0319166001600160a01b039092169190911790555b62001dde83838381811062001dc75762001dc762003f5d565b9050602002016020810190620005ad919062003b12565b62001ea457600683838381811062001dfa5762001dfa62003f5d565b905060200201602081019062001e11919062003b12565b81546001810183556000928352602090922090910180546001600160a01b0319166001600160a01b03909216919091179055600783838381811062001e5a5762001e5a62003f5d565b905060200201602081019062001e71919062003b12565b81546001810183556000928352602090922090910180546001600160a01b0319166001600160a01b039092169190911790555b60006002600085858581811062001ebf5762001ebf62003f5d565b905060200201602081019062001ed6919062003b12565b6001600160a01b0316815260208101919091526040016000205460ff16600381111562001f075762001f0762003c8f565b141562001f7c5760016002600085858581811062001f295762001f2962003f5d565b905060200201602081019062001f40919062003b12565b6001600160a01b031681526020810191909152604001600020805460ff1916600183600381111562001f765762001f7662003c8f565b02179055505b6000600c8185858581811062001f965762001f9662003f5d565b905060200201602081019062001fad919062003b12565b6001600160a01b0390811682526020820192909252604001600020541614156200218457600083838381811062001fe85762001fe862003f5d565b905060200201602081019062001fff919062003b12565b60405160200162002023919060609190911b6001600160601b031916815260140190565b60405160208183030381529060405280519060200120905060008185858581811062002053576200205362003f5d565b90506020020160208101906200206a919062003b12565b604051620020789062003a28565b6001600160a01b0390911681526020018190604051809103906000f5905080158015620020a9573d6000803e3d6000fd5b50905080600c6000878787818110620020c657620020c662003f5d565b9050602002016020810190620020dd919062003b12565b6001600160a01b039081168252602082019290925260400160002080546001600160a01b0319169290911691909117905584848481811062002123576200212362003f5d565b90506020020160208101906200213a919062003b12565b604080516001600160a01b03848116825242602083015292909216917f5e5b474625449a92e2b1a6f9f183435f09402d6897ae7f8779c72142ed11170b910160405180910390a250505b80620021908162003f3f565b91505062001c88565b507feacea8f3c22f06c0b18306bdb04d0a967255129e8ce0094debb0a0ff89d006b56005604051620021cc919062003fd8565b60405180910390a150506000805460ff19166001179055565b60078181548110620012dc57600080fd5b60008062002205600062003691565b915091509091565b6000805460ff16620022335760405162461bcd60e51b8152600401620009099062003ec1565b3360006001600160a01b03851660009081526002602052604090205460ff16600381111562002266576200226662003c8f565b1415620022ac5760405162461bcd60e51b815260206004820152601360248201527215985b1a59185d1bdc881b9bdd08195e1a5cdd606a1b604482015260640162000909565b6001600160a01b038082166000908152600360209081526040808320938816835292815282822060029091529190208154808611156200232f5760405162461bcd60e51b815260206004820152601860248201527f596f7520646f6e2774206861766520616e79207374616b650000000000000000604482015260640162000909565b85811415620024845760038201546200234b9060019062003fa8565b83600101541462002443576003820180546200236a9060019062003fa8565b815481106200237d576200237d62003f5d565b9060005260206000200160009054906101000a90046001600160a01b031682600301846001015481548110620023b757620023b762003f5d565b9060005260206000200160006101000a8154816001600160a01b0302191690836001600160a01b03160217905550826001015460036000846003018660010154815481106200240a576200240a62003f5d565b60009182526020808320909101546001600160a01b0390811684528382019490945260409283018220938c168252929092529020600101555b8160030180548062002459576200245962003fc2565b600082815260208120820160001990810180546001600160a01b031916905590910190915560018401555b82546200249290876200364d565b83556001820154620024a590876200364d565b6001830155600854620024b990876200364d565b6008556001600160a01b0384166000908152600d6020526040902054620024e190876200364d565b6001600160a01b038086166000818152600d6020526040902092909255881614156200255e57620025128762001938565b156200255e57825469021e19e0c9bab240000011156200255e5760405162461bcd60e51b815260040162000909906020808252600490820152630333030360e41b604082015260600190565b6001600160a01b038781166000908152600c60205260409081902054905163f3fef3a360e01b8152868316600482015260248101899052911690819063f3fef3a390604401600060405180830381600087803b158015620025be57600080fd5b505af1158015620025d3573d6000803e3d6000fd5b5050604080518a81524260208201526001600160a01b03808d169450891692507f449002ae18e748d69a55f38514400d64f966492e593e32d6e9b8b24db98a0bc1910160405180910390a36001955050505050505b92915050565b6001600160a01b038181166000908152600c60205260408082205490516246613160e11b815285841660048201529192169082908290628cc2629060240160206040518083038186803b1580156200268557600080fd5b505afa1580156200269a573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190620026c0919062003f73565b6001600160a01b038616600090815260046020526040902054909150620026e890826200297f565b95945050505050565b3341146200272f5760405162461bcd60e51b815260206004820152600a6024820152694d696e6572206f6e6c7960b01b604482015260640162000909565b436000908152600e602090815260408083206001845290915290205460ff16156200279d5760405162461bcd60e51b815260206004820152601a60248201527f56616c696461746f727320616c72656164792075706461746564000000000000604482015260640162000909565b60005460ff16620027c25760405162461bcd60e51b8152600401620009099062003ec1565b81620027cf814362004040565b15620028115760405162461bcd60e51b815260206004820152601060248201526f426c6f636b2065706f6368206f6e6c7960801b604482015260640162000909565b6000828152600e6020908152604080832060018085529252909120805460ff1916909117905583516200287e5760405162461bcd60e51b815260206004820152601460248201527356616c696461746f722073657420656d7074792160601b604482015260640162000909565b600b54604080516325dff9d160e01b815281516000936001600160a01b0316926325dff9d19260048082019391829003018186803b158015620028c057600080fd5b505afa158015620028d5573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190620028fb919062003ee7565b9150506000811180156200290f5750808310155b15620029785760058054620029279160079162003a36565b5084516200293d90600590602088019062003a8b565b507feacea8f3c22f06c0b18306bdb04d0a967255129e8ce0094debb0a0ff89d006b5856040516200296f919062003d24565b60405180910390a15b5050505050565b6000806200298e838562003f8d565b905083811015620029e25760405162461bcd60e51b815260206004820152601b60248201527f536166654d6174683a206164646974696f6e206f766572666c6f770000000000604482015260640162000909565b9392505050565b60005b60065481101562002a4d57826001600160a01b03166006828154811062002a175762002a1762003f5d565b6000918252602090912001546001600160a01b0316141562002a3857505050565b8062002a448162003f3f565b915050620029ec565b506006546015111562002ba25760068054600181019091557ff652222313e28459528d920b65115c16c04f3efc82aaedc97be59f3f377c0d3f0180546001600160a01b0319166001600160a01b038481169182179092556000908152600c602052604090205416620016d4576040516001600160601b0319606084901b1660208201526000906034016040516020818303038152906040528051906020012090506000818460405162002b009062003a28565b6001600160a01b0390911681526020018190604051809103906000f590508015801562002b31573d6000803e3d6000fd5b506001600160a01b038581166000818152600c602090815260409182902080546001600160a01b031916948616948517905581519384524290840152929350917f5e5b474625449a92e2b1a6f9f183435f09402d6897ae7f8779c72142ed11170b910160405180910390a250505050565b600060026000600660008154811062002bbf5762002bbf62003f5d565b60009182526020808320909101546001600160a01b03168352820192909252604001812060019081015492505b60065481101562002c9e5782600260006006848154811062002c125762002c1262003f5d565b60009182526020808320909101546001600160a01b03168352820192909252604001902060010154101562002c8957600260006006838154811062002c5b5762002c5b62003f5d565b60009182526020808320909101546001600160a01b0316835282019290925260400190206001015492509050805b8062002c958162003f3f565b91505062002bec565b5081831162002cad5750505050565b6001600160a01b038481166000908152600c60205260409020541662002db3576040516001600160601b0319606086901b1660208201526000906034016040516020818303038152906040528051906020012090506000818660405162002d149062003a28565b6001600160a01b0390911681526020018190604051809103906000f590508015801562002d45573d6000803e3d6000fd5b506001600160a01b038781166000818152600c602090815260409182902080546001600160a01b031916948616948517905581519384524290840152929350917f5e5b474625449a92e2b1a6f9f183435f09402d6897ae7f8779c72142ed11170b910160405180910390a250505b836006828154811062002dca5762002dca62003f5d565b9060005260206000200160006101000a8154816001600160a01b0302191690836001600160a01b0316021790555050505050565b8162002e08575050565b60008062002e168362003691565b90925090508062002e275750505050565b600080836200311557600062002e3e8785620037b7565b905062002e5862002e508286620037fb565b88906200364d565b925060005b60055481101562002ffb5760006005828154811062002e805762002e8062003f5d565b6000918252602090912001546001600160a01b0316905060036001600160a01b03821660009081526002602052604090205460ff16600381111562002ec95762002ec962003c8f565b1415801562002eea5750876001600160a01b0316816001600160a01b031614155b1562002fe5576001600160a01b03811660009081526004602052604090205462002f1590846200297f565b6001600160a01b0382166000908152600460209081526040808320939093556010815282822043835290522054909350839062002f5390846200297f565b6001600160a01b03821660008181526010602090815260408083204380855290835281842095909555928252601181528282209382529290925290205462002f9c90846200297f565b6001600160a01b03821660008181526011602090815260408083204384528252918290209390935551858152909160008051602062004fc5833981519152910160405180910390a25b508062002ff28162003f3f565b91505062002e5d565b506000831180156200301557506001600160a01b03821615155b156200310c576001600160a01b0382166000908152600460205260409020546200304090846200297f565b6001600160a01b03831660009081526004602090815260408083209390935560108152828220438352905220546200307990846200297f565b6001600160a01b038316600081815260106020908152604080832043808552908352818420959095559282526011815282822093825292909252902054620030c290846200297f565b6001600160a01b03831660008181526011602090815260408083204384528252918290209390935551858152909160008051602062004fc583398151915291015b60405180910390a25b50505050505050565b6000805b600554811015620034fe576000600582815481106200313c576200313c62003f5d565b6000918252602090912001546001600160a01b0316905060036001600160a01b03821660009081526002602052604090205460ff16600381111562003185576200318562003c8f565b14158015620031a65750876001600160a01b0316816001600160a01b031614155b15620034e7576000620031ef620031bf896002620037fb565b6001600160a01b038416600090815260026020526040902060010154620031e8908d90620037fb565b90620037b7565b905080620031ff575050620034e9565b6001600160a01b03821660009081526004602052604090205491945084916200322990826200297f565b6001600160a01b03831660009081526004602090815260408083209390935560118152828220438352905220546200326290826200297f565b6001600160a01b038381166000818152601160209081526040808320438452825280832095909555828252600c90528381205493516246613160e11b815260048101929092529290911691908290628cc2629060240160206040518083038186803b158015620032d157600080fd5b505afa158015620032e6573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906200330c919062003f73565b9050816001600160a01b031663abaa9916846040518263ffffffff1660e01b81526004016000604051808303818588803b1580156200334a57600080fd5b505af11580156200335f573d6000803e3d6000fd5b50506040516246613160e11b81526001600160a01b0388811660048301526000945086169250628cc262915060240160206040518083038186803b158015620033a757600080fd5b505afa158015620033bc573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190620033e2919062003f73565b90506200341f620033f4838362003fa8565b6001600160a01b0387166000908152601260209081526040808320438452909152902054906200297f565b6001600160a01b03861660009081526012602090815260408083204384529091529020556200347f62003454856002620037fb565b6001600160a01b0387166000908152601060209081526040808320438452909152902054906200297f565b6001600160a01b03861660008181526010602090815260408083204384528252918290209390935551868152909160008051602062004fc5833981519152910160405180910390a2620034e0620034d8856002620037fb565b88906200297f565b9650505050505b505b80620034f58162003f3f565b91505062003119565b506200350b87826200364d565b92506000831180156200352657506001600160a01b03821615155b156200310c576001600160a01b0382166000908152600460205260409020546200355190846200297f565b6001600160a01b03831660009081526004602090815260408083209390935560118152828220438352905220546200358a90846200297f565b6001600160a01b03831660008181526011602090815260408083204380855290835281842095909555928252601081528282209382529290925281208054859290620035d890849062003f8d565b90915550506040518381526001600160a01b0383169060008051602062004fc58339815191529060200162003103565b6001600160a01b03811660009081526002602052604081205460ff16600381111562003638576200363862003c8f565b1415620036425750565b620010638162003882565b6000620029e283836040518060400160405280601e81526020017f536166654d6174683a207375627472616374696f6e206f766572666c6f770000815250620039bf565b60008060005b600554811015620037b15760036002600060058481548110620036be57620036be62003f5d565b60009182526020808320909101546001600160a01b0316835282019290925260400190205460ff166003811115620036fa57620036fa62003c8f565b14158015620037365750600581815481106200371a576200371a62003f5d565b6000918252602090912001546001600160a01b03858116911614155b156200379c576200378a60026000600584815481106200375a576200375a62003f5d565b60009182526020808320909101546001600160a01b0316835282019290925260400190206001015484906200297f565b925081620037988162003f3f565b9250505b80620037a88162003f3f565b91505062003697565b50915091565b6000620029e283836040518060400160405280601a81526020017f536166654d6174683a206469766973696f6e206279207a65726f000000000000815250620039f5565b6000826200380c5750600062002628565b60006200381a838562004057565b90508262003829858362004079565b14620029e25760405162461bcd60e51b815260206004820152602160248201527f536166654d6174683a206d756c7469706c69636174696f6e206f766572666c6f6044820152607760f81b606482015260840162000909565b60005b600654811080156200389957506006546001105b15620016d45760068181548110620038b557620038b562003f5d565b6000918252602090912001546001600160a01b0383811691161415620039aa57600654620038e69060019062003fa8565b8114620039705760068054620038ff9060019062003fa8565b8154811062003912576200391262003f5d565b600091825260209091200154600680546001600160a01b03909216918390811062003941576200394162003f5d565b9060005260206000200160006101000a8154816001600160a01b0302191690836001600160a01b031602179055505b600680548062003984576200398462003fc2565b600082815260209020810160001990810180546001600160a01b03191690550190555050565b80620039b68162003f3f565b91505062003885565b60008184841115620039e65760405162461bcd60e51b815260040162000909919062004090565b506000620026e8848662003fa8565b6000818362003a195760405162461bcd60e51b815260040162000909919062004090565b506000620026e8848662004079565b610edc80620040e983390190565b82805482825590600052602060002090810192821562003a795760005260206000209182015b8281111562003a7957825482559160010191906001019062003a5c565b5062003a8792915062003ae3565b5090565b82805482825590600052602060002090810192821562003a79579160200282015b8281111562003a7957825182546001600160a01b0319166001600160a01b0390911617825560209092019160019091019062003aac565b5b8082111562003a87576000815560010162003ae4565b80356001600160a01b038116811462000df357600080fd5b60006020828403121562003b2557600080fd5b620029e28262003afa565b60008083601f84011262003b4357600080fd5b50813567ffffffffffffffff81111562003b5c57600080fd5b6020830191508360208260051b85010111156200133557600080fd5b6000806020838503121562003b8c57600080fd5b823567ffffffffffffffff81111562003ba457600080fd5b62003bb28582860162003b30565b90969095509350505050565b600081518084526020808501945080840160005b8381101562003bf05781518752958201959082019060010162003bd2565b509495945050505050565b602081526000620029e2602083018462003bbe565b60006020828403121562003c2357600080fd5b5035919050565b6000806040838503121562003c3e57600080fd5b62003c498362003afa565b946020939093013593505050565b6000806040838503121562003c6b57600080fd5b62003c768362003afa565b915062003c866020840162003afa565b90509250929050565b634e487b7160e01b600052602160045260246000fd5b600081518084526020808501945080840160005b8381101562003bf05781516001600160a01b03168752958201959082019060010162003cb9565b60006004861062003cf55762003cf562003c8f565b8582528460208301528360408301526080606083015262003d1a608083018462003ca5565b9695505050505050565b602081526000620029e2602083018462003ca5565b60008060006040848603121562003d4f57600080fd5b833567ffffffffffffffff81111562003d6757600080fd5b62003d758682870162003b30565b909790965060209590950135949350505050565b60608152600062003d9e606083018662003bbe565b828103602084015262003db2818662003bbe565b9050828103604084015262003d1a818562003bbe565b634e487b7160e01b600052604160045260246000fd5b60008060006060848603121562003df457600080fd5b833567ffffffffffffffff8082111562003e0d57600080fd5b818601915086601f83011262003e2257600080fd5b813560208282111562003e395762003e3962003dc8565b8160051b604051601f19603f8301168101818110868211171562003e615762003e6162003dc8565b60405292835281830193508481018201928a84111562003e8057600080fd5b948201945b8386101562003ea95762003e998662003afa565b8552948201949382019362003e85565b9a918901359950506040909701359695505050505050565b6020808252600c908201526b139bdd081a5b9a5d081e595d60a21b604082015260600190565b6000806040838503121562003efb57600080fd5b505080516020909101519092909150565b602081016003831062003f235762003f2362003c8f565b91905290565b634e487b7160e01b600052601160045260246000fd5b600060001982141562003f565762003f5662003f29565b5060010190565b634e487b7160e01b600052603260045260246000fd5b60006020828403121562003f8657600080fd5b5051919050565b6000821982111562003fa35762003fa362003f29565b500190565b60008282101562003fbd5762003fbd62003f29565b500390565b634e487b7160e01b600052603160045260246000fd5b6020808252825482820181905260008481528281209092916040850190845b818110156200401e5783546001600160a01b03168352600193840193928501920162003ff7565b50909695505050505050565b634e487b7160e01b600052601260045260246000fd5b6000826200405257620040526200402a565b500690565b600081600019048311821515161562004074576200407462003f29565b500290565b6000826200408b576200408b6200402a565b500490565b600060208083528351808285015260005b81811015620040bf57858101830151858201604001528201620040a1565b81811115620040d2576000604083870101525b50601f01601f191692909201604001939250505056fe608060405234801561001057600080fd5b50604051610edc380380610edc83398101604081905261002f91610102565b60028054336001600160a01b031991821617909155600580549091166001600160a01b03929092169190911790556040805160608101825243815260006020820181815292820181815260048054600181018255925291517f8a35acfbc15ff81a39ae7d344fd709f28e8600b4aa8c65c6b64bfe7fe36bd19b60039092029182015591517f8a35acfbc15ff81a39ae7d344fd709f28e8600b4aa8c65c6b64bfe7fe36bd19c830155517f8a35acfbc15ff81a39ae7d344fd709f28e8600b4aa8c65c6b64bfe7fe36bd19d90910155610132565b60006020828403121561011457600080fd5b81516001600160a01b038116811461012b57600080fd5b9392505050565b610d9b806101416000396000f3fe6080604052600436106100a65760003560e01c806370a082311161006457806370a082311461016a578063714b4658146101a0578063abaa9916146101d6578063c00007b0146101de578063e673df8a146101fe578063f3fef3a31461021e57600080fd5b80628cc262146100ab57806318160ddd146100de57806326476204146100f35780633a5381b5146101085780633f9e3f0414610140578063446a2ec814610155575b600080fd5b3480156100b757600080fd5b506100cb6100c6366004610bf4565b61023e565b6040519081526020015b60405180910390f35b3480156100ea57600080fd5b506000546100cb565b610106610101366004610bf4565b6102cf565b005b34801561011457600080fd5b50600554610128906001600160a01b031681565b6040516001600160a01b0390911681526020016100d5565b34801561014c57600080fd5b506100cb610414565b34801561016157600080fd5b506100cb61042a565b34801561017657600080fd5b506100cb610185366004610bf4565b6001600160a01b031660009081526001602052604090205490565b3480156101ac57600080fd5b506100cb6101bb366004610bf4565b6001600160a01b031660009081526003602052604090205490565b61010661043d565b3480156101ea57600080fd5b506101066101f9366004610bf4565b6104be565b34801561020a57600080fd5b50600254610128906001600160a01b031681565b34801561022a57600080fd5b50610106610239366004610c11565b610623565b600080610249610757565b604001519050600061025a846107d1565b6040908101516001600160a01b03861660009081526003602052918220600101549092506102c6906102c0670de0b6b3a76400006102ba61029b8888610864565b6001600160a01b038b16600090815260016020526040902054906108af565b9061092e565b90610970565b95945050505050565b6002546001600160a01b031633146103025760405162461bcd60e51b81526004016102f990610c3d565b60405180910390fd5b806001600160a01b03811615610383576001600160a01b038116600090815260036020908152604091829020825180840190935280548352600101549082015261034b8261023e565b6020820152610358610414565b81526001600160a01b0382166000908152600360209081526040909120825181559101516001909101555b34806103c25760405162461bcd60e51b815260206004820152600e60248201526d043616e6e6f74207374616b6520360941b60448201526064016102f9565b6103cc83826109cf565b826001600160a01b03167f9e71bc8eea02a63969f509818f2dafb9254532904319f9dbda79b67bd34a5f3d8260405161040791815260200190565b60405180910390a2505050565b600454600090610425906001610864565b905090565b6000610434610757565b60400151905090565b6002546001600160a01b031633146104675760405162461bcd60e51b81526004016102f990610c3d565b34806104705750565b61047981610a21565b6005546040518281526001600160a01b03909116907f7d8f3d9291db7e540ea10a43e300f1330c3e9148157349babe42ac2601a2a3e99060200160405180910390a250565b6002546001600160a01b031633146104e85760405162461bcd60e51b81526004016102f990610c3d565b806001600160a01b03811615610569576001600160a01b03811660009081526003602090815260409182902082518084019093528054835260010154908201526105318261023e565b602082015261053e610414565b81526001600160a01b0382166000908152600360209081526040909120825181559101516001909101555b6001600160a01b038216600090815260036020526040902060010154801561061e576001600160a01b0383166000818152600360205260408082206001018290555183156108fc0291849190818181858888f193505050501580156105d2573d6000803e3d6000fd5b50600554604080518381524260208201526001600160a01b03928316928616917f51a69b4502f660774c9339825c7b5adbf0b8622289134647e29728ec5d9b3bb9910160405180910390a35b505050565b6002546001600160a01b0316331461064d5760405162461bcd60e51b81526004016102f990610c3d565b816001600160a01b038116156106ce576001600160a01b03811660009081526003602090815260409182902082518084019093528054835260010154908201526106968261023e565b60208201526106a3610414565b81526001600160a01b0382166000908152600360209081526040909120825181559101516001909101555b600082116107125760405162461bcd60e51b8152602060048201526011602482015270043616e6e6f74207769746864726177203607c1b60448201526064016102f9565b61071c8383610b04565b826001600160a01b03167f7084f5476618d8e60b11ef0d7d3f06914655adb8793e28ff7f018d4c76d505d58360405161040791815260200190565b61077b60405180606001604052806000815260200160008152602001600081525090565b6004610785610414565b8154811061079557610795610c74565b90600052602060002090600302016040518060600160405290816000820154815260200160018201548152602001600282015481525050905090565b6107f560405180606001604052806000815260200160008152602001600081525090565b6004610816836001600160a01b031660009081526003602052604090205490565b8154811061082657610826610c74565b906000526020600020906003020160405180606001604052908160008201548152602001600182015481526020016002820154815250509050919050565b60006108a683836040518060400160405280601e81526020017f536166654d6174683a207375627472616374696f6e206f766572666c6f770000815250610b7d565b90505b92915050565b6000826108be575060006108a9565b60006108ca8385610ca0565b9050826108d78583610cbf565b146108a65760405162461bcd60e51b815260206004820152602160248201527f536166654d6174683a206d756c7469706c69636174696f6e206f766572666c6f6044820152607760f81b60648201526084016102f9565b60006108a683836040518060400160405280601a81526020017f536166654d6174683a206469766973696f6e206279207a65726f000000000000815250610bae565b60008061097d8385610ce1565b9050838110156108a65760405162461bcd60e51b815260206004820152601b60248201527f536166654d6174683a206164646974696f6e206f766572666c6f77000000000060448201526064016102f9565b6000546109dc9082610970565b60009081556001600160a01b038316815260016020526040902054610a019082610970565b6001600160a01b0390921660009081526001602052604090209190915550565b6000610a2b610757565b6040015190506000610a5b610a54610a4260005490565b6102ba86670de0b6b3a76400006108af565b8390610970565b60408051606081018252438152602081019586529081019182526004805460018101825560009190915290517f8a35acfbc15ff81a39ae7d344fd709f28e8600b4aa8c65c6b64bfe7fe36bd19b60039092029182015593517f8a35acfbc15ff81a39ae7d344fd709f28e8600b4aa8c65c6b64bfe7fe36bd19c850155517f8a35acfbc15ff81a39ae7d344fd709f28e8600b4aa8c65c6b64bfe7fe36bd19d909301929092555050565b600054610b119082610864565b60009081556001600160a01b038316815260016020526040902054610b369082610864565b6001600160a01b038316600081815260016020526040808220939093559151909183156108fc02918491818181858888f1935050505015801561061e573d6000803e3d6000fd5b60008184841115610ba15760405162461bcd60e51b81526004016102f99190610cf9565b5060006102c68486610d4e565b60008183610bcf5760405162461bcd60e51b81526004016102f99190610cf9565b5060006102c68486610cbf565b6001600160a01b0381168114610bf157600080fd5b50565b600060208284031215610c0657600080fd5b81356108a681610bdc565b60008060408385031215610c2457600080fd5b8235610c2f81610bdc565b946020939093013593505050565b6020808252601a908201527f43616c6c6572206973206e6f7420746865206f70657261746f72000000000000604082015260600190565b634e487b7160e01b600052603260045260246000fd5b634e487b7160e01b600052601160045260246000fd5b6000816000190483118215151615610cba57610cba610c8a565b500290565b600082610cdc57634e487b7160e01b600052601260045260246000fd5b500490565b60008219821115610cf457610cf4610c8a565b500190565b600060208083528351808285015260005b81811015610d2657858101830151858201604001528201610d0a565b81811115610d38576000604083870101525b50601f01601f1916929092016040019392505050565b600082821015610d6057610d60610c8a565b50039056fea26469706673582212209d5d1aaddef089e48bab9216a6960641a0f40869b4b9368c7faab70a3add8f8564736f6c634300080800337d8f3d9291db7e540ea10a43e300f1330c3e9148157349babe42ac2601a2a3e9a26469706673582212206fc64d51ec485b465d3b6087dac3adc36151ded552aa9460af1940577aa0eed864736f6c63430008080033"
)

type hardForkValidatorsV4 struct {
}

func (s *hardForkValidatorsV4) GetName() string {
	return ValidatorsV2ContractName
}

func (s *hardForkValidatorsV4) Update(config *params.ChainConfig, height *big.Int, state *state.StateDB) (err error) {
	contractCode := common.FromHex(validatorV4Code)

	//write code to sys contract
	state.SetCode(ValidatorsV2ContractAddr, contractCode)
	log.Debug("Write code to system contract account", "addr", ValidatorsV2ContractAddr.String(), "code", validatorV4Code)

	return
}

func (s *hardForkValidatorsV4) Execute(state *state.StateDB, header *types.Header, chainContext core.ChainContext, config *params.ChainConfig) (err error) {

	return
}
